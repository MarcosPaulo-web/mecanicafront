<!-- src/app/componentes/modal-agendamento/modal-agendamento.html -->
<div
  class="modal fade"
  id="modalAgendamento"
  tabindex="-1"
  aria-labelledby="modalAgendamentoLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary-mecanica text-white">
        <h5 class="modal-title" id="modalAgendamentoLabel">
          {{ agendamento ? 'Editar Agendamento' : 'Novo Agendamento' }}
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          (click)="fecharModal()"
          aria-label="Close"
        ></button>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div class="row g-3">
            <!-- Cliente -->
            <div class="col-md-6">
              <label for="cdCliente" class="form-label fw-semibold"
                >Cliente <span class="text-danger">*</span></label
              >
              <select
                class="form-select"
                id="cdCliente"
                formControlName="cdCliente"
                [class.is-invalid]="isInvalid('cdCliente')"
                (change)="onClienteChange()"
              >
                <option value="">Selecione um cliente</option>
                @for (cliente of clientes; track cliente.cdCliente) {
                <option [value]="cliente.cdCliente">{{ cliente.nmCliente }}</option>
                }
              </select>
              @if (isInvalid('cdCliente')) {
              <div class="invalid-feedback">
                {{ getMensagemErro('cdCliente') }}
              </div>
              }
            </div>

            <!-- Veículo -->
            <div class="col-md-6">
              <label for="cdVeiculo" class="form-label fw-semibold"
                >Veículo <span class="text-danger">*</span></label
              >
              <select
                class="form-select"
                id="cdVeiculo"
                formControlName="cdVeiculo"
                [class.is-invalid]="isInvalid('cdVeiculo')"
                [disabled]="!form.value.cdCliente"
              >
                <option value="">Selecione um veículo</option>
                @for (veiculo of veiculos; track veiculo.cdVeiculo) {
                <option [value]="veiculo.cdVeiculo">
                  {{ veiculo.modelo }} - {{ veiculo.placa }}
                </option>
                }
              </select>
              @if (isInvalid('cdVeiculo')) {
              <div class="invalid-feedback">
                {{ getMensagemErro('cdVeiculo') }}
              </div>
              }
            </div>

            <!-- Mecânico -->
            <div class="col-12">
              <label for="cdUsuario" class="form-label fw-semibold"
                >Mecânico <span class="text-danger">*</span></label
              >
              <select
                class="form-select"
                id="cdUsuario"
                formControlName="cdUsuario"
                [class.is-invalid]="isInvalid('cdUsuario')"
              >
                <option value="">Selecione um mecânico</option>
                @for (mecanico of mecanicos; track mecanico.cdUsuario) {
                <option [value]="mecanico.cdUsuario">{{ mecanico.nmUsuario }}</option>
                }
              </select>
              @if (isInvalid('cdUsuario')) {
              <div class="invalid-feedback">
                {{ getMensagemErro('cdUsuario') }}
              </div>
              }
            </div>

            <!-- Data e Horário -->
            <div class="col-md-6">
              <label for="dataAgendamento" class="form-label fw-semibold"
                >Data e Horário <span class="text-danger">*</span></label
              >
              <input
                type="datetime-local"
                class="form-control"
                id="dataAgendamento"
                formControlName="dataAgendamento"
                [class.is-invalid]="isInvalid('dataAgendamento')"
              />
              @if (isInvalid('dataAgendamento')) {
              <div class="invalid-feedback">
                {{ getMensagemErro('dataAgendamento') }}
              </div>
              }
            </div>

            <!-- Status -->
            <div class="col-md-6">
              <label for="status" class="form-label fw-semibold">Status</label>
              <select
                class="form-select"
                id="status"
                formControlName="status"
                [class.is-invalid]="isInvalid('status')"
              >
                <option value="AGENDADO">Agendado</option>
                <option value="EM_ANDAMENTO">Em Andamento</option>
                <option value="CONCLUIDO">Concluído</option>
                <option value="CANCELADO">Cancelado</option>
              </select>
            </div>

            <!-- Observações -->
            <div class="col-12">
              <label for="observacoes" class="form-label fw-semibold">Observações</label>
              <textarea
                class="form-control"
                id="observacoes"
                formControlName="observacoes"
                [class.is-invalid]="isInvalid('observacoes')"
                rows="3"
                placeholder="Informações adicionais sobre o agendamento"
              ></textarea>
              @if (isInvalid('observacoes')) {
              <div class="invalid-feedback">
                {{ getMensagemErro('observacoes') }}
              </div>
              }
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="fecharModal()">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary-mecanica">
            <i class="bi bi-save"></i>
            {{ agendamento ? 'Atualizar' : 'Cadastrar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>