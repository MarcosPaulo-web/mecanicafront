<div class="container-xxl mb-4 pt-5 bg-body">
  <app-loading [show]="loading" message="Carregando ordens..." />

  <div class="row align-items-center">
    <div class="col-6">
      <app-titulo title="Ordens de Serviço" subtitle="Gerencie todas as ordens de serviço" />
    </div>
    <div class="col-6 text-end">
      <button class="btn btn-primary-mecanica" (click)="abrirModalNova()">
        <i class="bi bi-plus-lg"></i> Nova Ordem
      </button>
    </div>
  </div>

  <app-pesquisa-filtro
    [listFiltro]="listFiltro"
    (receberFiltro)="filtrarPorStatus($event)"
    (pesquisa)="filtrarPorTexto($event)"
    label="Pesquise por OS, cliente ou placa..."
  />

  <div class="row bg-body mt-5 border border-1 border-body border-opacity-25 rounded-4 pt-3">
    @if (ordensFiltradas.length === 0) {
    <div class="col-12 text-center py-5">
      <i class="bi bi-inbox fs-1 text-muted"></i>
      <p class="text-muted mt-3">Nenhuma ordem de serviço encontrada</p>
    </div>
    } @else {
    <app-tabela [cabecario]="cabecalho">
      @for (ordem of ordensFiltradas; track ordem.cdOrdemServico) {
      <tr>
        <th scope="row">OS-{{ ordem.cdOrdemServico }}</th>
        <td>{{ ordem.nmCliente }}</td>
        <td>
          {{ ordem.placa }}
        </td>
        <td>{{ ordem.nmMecanico }}</td>
        <td>
          <span class="badge fw-semibold" [ngClass]="getStatusClass(ordem.statusOrdemServico)">
            {{ getStatusLabel(ordem.statusOrdemServico) }}
          </span>
        </td>
        <td>{{ formatarData(ordem.dataAbertura) }}</td>
        <td>R$ {{ ordem.vlTotal.toFixed(2) }}</td>
        <td>
          <button class="btn" (click)="editar(ordem)">
            <i class="bi bi-eye-fill"></i>
          </button>
        </td>
      </tr>
      }
    </app-tabela>
    }
  </div>

  <app-modal-ordem-servico #modal tipo="ORDEM_DE_SERVICO" />
</div>
