<main class="container-xxl py-5">
  <app-loading [show]="loading" message="Carregando faturamento..." />
  
  <app-titulo title="Faturamento" subtitle="Visão completa do faturamento e lucro da oficina" />

  <div class="row mt-5 border border-body p-3 rounded-3 row-gap-2">
    <div class="col-sm-8 col-md-4 col-lg-2">
      <app-dropdown-botao [listDropdown]="listaFiltro" (mandarFiltro)="getFiltro($event)" />
    </div>
    <div class="col-sm-8 col-md-4 col-lg-2">
      <input class="form-control" readonly type="text" [value]="getValorInputFiltro()" />
    </div>
  </div>

  <div class="row mt-5 row-gap-3">
    <div class="col-sm-12 col-md-6 col-lg-4">
      <app-card [title]="'Receita Total'" [num]="'R$ ' + totalFaturado.toFixed(2)">
        <i class="bi bi-currency-dollar"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-4">
      <app-card [title]="'Serviços'" [num]="'R$ ' + totalServicos.toFixed(2)">
        <i class="bi bi-wrench"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-4">
      <app-card [title]="'Produtos'" [num]="'R$ ' + totalProdutos.toFixed(2)">
        <i class="bi bi-box-seam"></i>
      </app-card>
    </div>
  </div>

  <div class="row border border-body mt-5 p-3 rounded-4">
    <h5>Faturamento</h5>
    <div class="row mt-3">
      @if (faturamentos.length === 0) {
      <div class="col-12 text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted"></i>
        <p class="text-muted mt-3">Nenhum faturamento para o período selecionado</p>
      </div>
      } @else {
      <app-tabela [cabecario]="cabecario">
        @for (item of faturamentos; track item.cdFaturamento) {
        <tr>
          <td>
            <span class="badge" [ngClass]="item.tipoTransacao === 'SERVICO' ? 'bg-primary' : 'bg-success'">
              {{ item.tipoTransacao }}
            </span>
          </td>
          <td>{{ item.nomeCliente }}</td>
          <td>{{ formatarData(item.dataVenda) }}</td>
          <td>{{ item.formaPagamento }}</td>
          <td class="fw-bold text-success">R$ {{ item.vlTotal.toFixed(2) }}</td>
        </tr>
        }
      </app-tabela>
      }
    </div>
  </div>
</main>