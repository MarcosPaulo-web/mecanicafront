<!-- src/app/view/vendas/vendas.html -->
<main class="container-xxl py-5">
  <app-loading [show]="loading" message="Carregando vendas..." />

  <div class="row align-items-center">
    <div class="col-6 text-start">
      <app-titulo title="Vendas" subtitle="Gerencie as vendas de produtos" />
    </div>
    <div class="col-6 text-end">
      <button class="btn btn-primary-mecanica" (click)="abrirModalNova()">
        <i class="bi bi-cart-plus"></i> Nova venda
      </button>
    </div>
  </div>

  <div class="row mt-5 row-gap-2">
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Total de Vendas'" [num]="totalVendas.toString()">
        <i class="bi bi-cart"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Total Faturado'" [num]="'R$ ' + totalFaturado.toFixed(2)">
        <i class="bi bi-currency-dollar"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Vendas Hoje'" [num]="vendasHoje.toString()">
        <i class="bi bi-calendar-check"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Total Hoje'" [num]="'R$ ' + totalHoje.toFixed(2)">
        <i class="bi bi-cash-stack"></i>
      </app-card>
    </div>
  </div>

  <div class="row mt-5 rounded-4 border border-body p-4">
    <div class="col-12">
      <app-input-pesquisa
        (pesquisa)="filtrarVendas($event)"
        label="Pesquise por cliente ou atendente..."
      />
    </div>
  </div>

  <div class="row border border-body rounded-4 pt-3 mt-5">
    <h5 class="mb-3">HistÃ³rico de Vendas</h5>

    @if (vendasFiltradas.length === 0) {
    <div class="col-12 text-center py-5">
      <i class="bi bi-inbox fs-1 text-muted"></i>
      <p class="text-muted mt-3">Nenhuma venda encontrada</p>
    </div>
    } @else {
    <app-tabela [cabecario]="colunas">
      @for (venda of vendasFiltradas; track venda.cdVenda) {
      <tr>
        <td>#{{ venda.cdVenda }}</td>
        <td>{{ venda.nmCliente }}</td>
        <td>{{ venda.nmAtendente }}</td>
        <td>{{ formatarData(venda.dataVenda) }}</td>
        <td>
          <span class="badge bg-secondary">
            {{ formatarFormaPagamento(venda.formaPagamento) }}
          </span>
        </td>
        <td>R$ {{ venda.vlTotal.toFixed(2) }}</td>
        <td>
          <button class="btn" (click)="visualizarVenda(venda)">
            <i class="bi bi-eye"></i>
          </button>
        </td>
      </tr>
      }
    </app-tabela>
    }
  </div>

  <app-modal-venda (salvar)="salvarVenda($event)" (fechar)="fecharModal()" />
</main>
