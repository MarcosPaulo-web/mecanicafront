<main class="container-xxl py-5">
  <app-loading [show]="loading" message="Carregando orçamentos..." />

  <div class="row justify-content-between align-items-center">
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-titulo title="Orçamentos" subtitle="Gerencie todos os orçamentos da oficina" />
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3 text-end">
      <button class="btn btn-primary-mecanica" (click)="abrirModalNova()">
        <i class="bi bi-plus-lg"></i> Novo Orçamento
      </button>
    </div>
  </div>

  <div class="row mt-5 row-gap-2">
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Total'" [num]="totalOrcamentos.toString()">
        <i class="bi bi-file-earmark-text-fill"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Pendentes'" [num]="orcamentosPendentes.toString()">
        <i class="bi bi-clock"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Aprovados'" [num]="orcamentosAprovados.toString()">
        <i class="bi bi-check-circle"></i>
      </app-card>
    </div>
  </div>

  <div class="row">
    <app-pesquisa-filtro
      label="Buscar por número, cliente ou placa..."
      [listFiltro]="listFiltro"
      (receberFiltro)="filtrarPorStatus($event)"
      (pesquisa)="filtrarPorTexto($event)"
    />
  </div>

  <div class="row mt-5 border border-body p-3 rounded-4">
    <h5>Lista de Orçamentos</h5>
    <div class="row mt-4">
      @if (orcamentosFiltrados.length === 0) {
      <div class="col-12 text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted"></i>
        <p class="text-muted mt-3">Nenhum orçamento encontrado</p>
      </div>
      } @else {
      <app-tabela [cabecario]="listaCabecario">
        @for (orcamento of orcamentosFiltrados; track orcamento.cdOrdemServico) {
        <tr>
          <td>ORC-{{ orcamento.cdOrdemServico }}</td>
          <td>{{ orcamento.nmCliente }}</td>
          <td>
            {{ orcamento.placa }}
          </td>
          <td>{{ formatarData(orcamento.dataAbertura) }}</td>
          <td>R$ {{ orcamento.vlTotal.toFixed(2) }}</td>
          <td>
            <span class="badge" [ngClass]="getStatusClass(orcamento)">
              {{ getStatusOrcamento(orcamento) }}
            </span>
          </td>
          <td>
            @if (!orcamento.aprovado) {
            <button
              class="btn btn-success btn-sm"
              (click)="aprovarOrcamento(orcamento)"
              title="Aprovar orçamento"
            >
              <i class="bi bi-check-circle"></i>
            </button>
            }
            <button class="btn btn-secondary btn-sm" title="Visualizar">
              <i class="bi bi-eye"></i>
            </button>
          </td>
        </tr>
        }
      </app-tabela>
      }
    </div>
  </div>
  <app-modal-ordem-servico #modal tipo="ORCAMENTO" />
</main>
