<main class="container-xxl py-5">
  <app-loading [show]="loading" message="Carregando mecânicos..." />

  <div class="row justify-content-between align-items-center">
    <div class="col-6">
      <app-titulo title="Mecânicos" subtitle="Gerencie a equipe de mecânicos" />
    </div>
    <div class="col-3 text-end">
      <button class="btn btn-primary-mecanica" (click)="abrirModalNovo()">
        <i class="bi bi-plus-lg"></i> Novo Mecânico
      </button>
    </div>
  </div>

  <div class="row mt-5 row-gap-2">
    <div class="col-sm-12 col-md-6 col-lg-4">
      <app-card [title]="'Total'" [num]="totalMecanicos.toString()">
        <i class="bi bi-wrench"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-4">
      <app-card [title]="'Ativos'" [num]="mecanicosAtivos.toString()">
        <i class="bi bi-wrench"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-4">
      <app-card [title]="'Inativos'" [num]="mecanicosInativos.toString()">
        <i class="bi bi-wrench"></i>
      </app-card>
    </div>
  </div>

  <div class="row border border-body rounded-3 p-2 mt-5">
    <app-input-pesquisa
      (pesquisa)="filtrarMecanicos($event)"
      label="Buscar por nome, email ou CPF"
    />
  </div>

  <div class="row mt-5 border border-body rounded-4 p-3">
    @if (mecanicosFiltrados.length === 0) {
    <div class="col-12 text-center py-5">
      <i class="bi bi-inbox fs-1 text-muted"></i>
      <p class="text-muted mt-3">Nenhum mecânico encontrado</p>
    </div>
    } @else {
    <app-tabela [cabecario]="listaCabecario">
      @for (mecanico of mecanicosFiltrados; track mecanico.cdUsuario) {
      <tr>
        <td>{{ mecanico.nmUsuario }}</td>
        <td>{{ mecanico.nuCPF | cpf }}</td>
        <td>{{ mecanico.nuTelefone | telefone }}</td>
        <td>{{ mecanico.email }}</td>
        <td>
          <span class="badge" [ngClass]="mecanico.ativo ? 'bg-success' : 'bg-danger'">
            {{ mecanico.ativo ? 'Ativo' : 'Inativo' }}
          </span>
        </td>
        <td>
          <button class="btn" (click)="abrirModalEditar(mecanico)">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button class="btn text-danger" (click)="deletarMecanico(mecanico)">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      </tr>
      }
    </app-tabela>
    }
  </div>

  <app-modal-usuario
    #modalUsuario
    [usuario]="mecanicoSelecionado"
    (salvar)="salvarMecanico($event)"
    (fechar)="mecanicoSelecionado = undefined"
  />
</main>
