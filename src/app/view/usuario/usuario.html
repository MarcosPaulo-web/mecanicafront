<main class="container-xxl py-5">
  <app-loading [show]="loading" message="Carregando usuários..." />

  <div class="row justify-content-between align-items-center">
    <div class="col-6">
      <app-titulo
        title="Gerenciamento de Usuários"
        subtitle="Cadastre e gerencie atendentes e mecânicos"
      />
    </div>
    <div class="col-3 text-end">
      <button class="btn btn-primary-mecanica" (click)="abrirModalNovo()">
        <i class="bi bi-person-plus-fill"></i> Novo usuário
      </button>
    </div>
  </div>

  <div class="row mt-5 row-gap-2">
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Total'" [num]="totalUsuarios.toString()">
        <i class="bi bi-person"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Administradores'" [num]="totalAdmins.toString()">
        <i class="bi bi-person"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Atendentes'" [num]="totalAtendentes.toString()">
        <i class="bi bi-person"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Mecânicos'" [num]="totalMecanicos.toString()">
        <i class="bi bi-person"></i>
      </app-card>
    </div>
  </div>

  <div class="row">
    <app-pesquisa-filtro
      label="Pesquise por nome ou Email..."
      [listFiltro]="listFiltro"
      (pesquisa)="filtrarPorTexto($event)"
      (receberFiltro)="filtrarPorRole($event)"
    />
  </div>

  <div class="row p-3 mt-5 border border-body rounded-4">
    <h5>Usuários Cadastrados</h5>
    <div class="row">
      @if (usuariosFiltrados.length === 0) {
      <div class="col-12 text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted"></i>
        <p class="text-muted mt-3">Nenhum usuário encontrado</p>
      </div>
      } @else {
      <app-tabela [cabecario]="listaCabecario">
        @for (usuario of usuariosFiltrados; track usuario.cdUsuario) {
        <tr>
          <td>{{ usuario.nmUsuario }}</td>
          <td>{{ usuario.email }}</td>
          <td>{{ usuario.nuTelefone | telefone || '-' }}</td>
          <td>{{ usuario.nuCPF | cpf || '-' }}</td>
          <td>
            <span class="badge" [ngClass]="getRoleClass(usuario.roles)">
              {{ getRoleLabel(usuario.roles) }}
            </span>
          </td>
          <td class="d-flex gap-3">
            <button class="btn btn-secondary" (click)="abrirModalEditar(usuario)">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-secondary" (click)="deletarUsuario(usuario)">
              <i class="bi bi-trash text-danger"></i>
            </button>
          </td>
        </tr>
        }
      </app-tabela>
      }
    </div>
  </div>

  <app-modal-usuario
    [usuario]="usuarioSelecionado"
    (salvar)="salvarUsuario($event)"
    (fechar)="usuarioSelecionado = undefined"
  />
</main>