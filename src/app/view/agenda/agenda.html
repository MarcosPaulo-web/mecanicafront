<!-- src/app/view/agenda/agenda.html -->
<main class="container-xxl py-5">
  <app-loading [show]="loading" message="Carregando agendamentos..." />

  <div class="row justify-content-between align-items-center">
    <div class="col-6">
      <app-titulo
        title="Agenda"
        subtitle="Gerencie os agendamentos e disponibilidade dos mecânicos"
      />
    </div>
    <div class="col-6 text-end">
      <button class="btn btn-primary-mecanica" (click)="abrirModalNovo()">
        <i class="bi bi-plus-lg"></i> Novo Agendamento
      </button>
    </div>
  </div>

  <div class="row row-gap-2 border border-body border-opacity-25 p-3 rounded-4 mt-4">
    <div class="col-sm-12 col-md-6 col-lg-3">
      <input
        class="form-control"
        type="date"
        name="dataAgendamento"
        id="dataAgendamento"
        [ngModel]="dateString"
        (ngModelChange)="onDateChange($event)"
      />
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-dropdown-botao
        [listDropdown]="listaMecanico"
        (mandarFiltro)="selecionarMecanico($event)"
      />
    </div>
  </div>

  <div class="row mt-5 row-gap-3">
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Total'" [num]="totalAgendamentos.toString()">
        <i class="bi bi-calendar"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Agendados'" [num]="agendamentosAbertos.toString()">
        <i class="bi bi-clock"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Em Andamento'" [num]="agendamentosEmAndamento.toString()">
        <i class="bi bi-gear"></i>
      </app-card>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Finalizados'" [num]="agendamentosFinalizados.toString()">
        <i class="bi bi-check-circle"></i>
      </app-card>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-sm-12 col-md-6 col-lg-3">
      <app-card [title]="'Mecânicos'" [num]="mecanicos.length.toString()">
        <i class="bi bi-people-fill"></i>
      </app-card>
    </div>
  </div>

  <div class="row border border-body border-opacity-25 rounded-4 mt-4 p-3">
    <h5>Agendamentos - {{ date | date : "EEEE, dd 'de' MMMM 'de' yyyy" }}</h5>

    @if (listaMecanicos.length === 0) {
    <div class="col-12 text-center py-5">
      <i class="bi bi-calendar-x fs-1 text-muted"></i>
      <p class="text-muted mt-3">Nenhum agendamento para esta data</p>
    </div>
    } @else {
    <div class="row row-gap-3 mt-3 overflow-y-auto" style="max-height: 500px">
      <div class="col-12">
        <app-card-agendamento [mecanicos]="listaMecanicos" />
      </div>
    </div>
    }
  </div>

  <app-modal-agendamento
    [agendamento]="agendamentoSelecionado"
    (salvar)="salvarAgendamento($event)"
    (fechar)="agendamentoSelecionado = undefined"
  />
</main>
